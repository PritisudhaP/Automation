var returnsCreateScreen = require(process.cwd() + '/src/tests/screens/returns/returns.create.screen.js');
var returnsEditScreen = require(process.cwd() + '/src/tests/screens/returns/returns.edit.screen.js');
var returnsSummaryScreen = require(process.cwd() + '/src/tests/screens/returns/returns.summary.screen.js');
var inventorySearchScreen = require(process.cwd() + '/src/tests/screens/inventorySearch/inventorySearch.summary.screen.js');


var common = require(process.cwd() + '/src/tests/screens/commons.js');
global.RMANumber="";
global.currentAvlQty="";
global.updatedAvlQty="";

describe('Returns Flow  : ', function(){
    var returnsCreate = new returnsCreateScreen();
    var returnsEdit = new returnsEditScreen();
    var returnsSummary = new returnsSummaryScreen();
    var inventorySearch = new inventorySearchScreen();
    var commons = new common();

        it('Returns that release successfully - TC0001', function(){
             
            browser.get(returnsUrl);

            console.log("navigating to Returns  new screen"); 
            commons.new(); 
            browser.driver.sleep(2);
            browser.waitForAngular();

            returnsCreate.blindReturn(); 
            browser.driver.sleep(1000);
            returnsCreate.channelSelect("Fulfillment");
            commons.customerLookup();
            
            returnsCreate.searchCustomer("Email","MUSICA");
            commons.search();
            returnsCreate.selectCustomer();
            returnsCreate.useSelectedCustomer();
            
            returnsCreate.returnLocationSelect("Fitchburg-DC");
            returnsCreate.saveReturns();
             
            returnsCreate.productLookup();
            returnsCreate.enterProductName("0-0-1");           
            returnsCreate.searchModalWindow();
            returnsCreate.selectProduct();
            returnsCreate.addProduct();
            returnsCreate.returnReason("1", "DAMAGED");

            browser.sleep(2000);           
 
            returnsCreate.productLookup();
            returnsCreate.enterProductName("0-2");           
            returnsCreate.searchModalWindow();
            browser.sleep(2000);
            returnsCreate.selectProduct();
            returnsCreate.addProduct();
            returnsCreate.returnReason("2", "DOES NOT FIT");
            
            returnsCreate.creditType("REFUND");
            returnsCreate.saveReturns();

            browser.sleep(3000);
          
            returnsCreate.getRMANumber().then(function(value) {
                RMANumber = value.substring(34,44);;
            });
            
            browser.wait(function() {
                return RMANumber != '';
            }).then(function() {
                browser.get(returnsUrl);
                console.log(RMANumber); 
                returnsSummary.returnsSearch("RMA Number", RMANumber);
                browser.sleep(2000);
                returnsSummary.returnsSelectGear("Release");
                expect(returnsSummary.returnsStatus()).toEqual('RELEASED');
                browser.sleep(2000);
                browser.get(inventorySearchUrl);
                inventorySearch.enterSite("Fitchburg-DC");
                inventorySearch.addSKU();
                inventorySearch.searchSKU("Name","0-0-1");
                browser.sleep(2000);
                inventorySearch.selectSKU();
                inventorySearch.addProduct();
                browser.sleep(2000);
                inventorySearch.searchInventory();
                browser.sleep(2000);
                
                inventorySearch.getAvailableQty().then(function(value) {
                    currentAvlQty = value;
                    updatedAvlQty = parseInt(currentAvlQty) + 1;
                });
                
                browser.get(returnsUrl);
                returnsSummary.returnsSearch("RMA Number", RMANumber);
                browser.sleep(2000);
                returnsSummary.returnsSelectGear("View");
                browser.sleep(2000); 
                returnsEdit.returnExpectedReceiptSelectOption("Receive Inventory","Fitchburg-DC");
                browser.sleep(2000);

           
                browser.wait(function() {
                    return updatedAvlQty != '';
                }).then(function() {
    				browser.get(inventorySearchUrl);
					inventorySearch.enterSite("Fitchburg-DC");
					inventorySearch.addSKU();
					inventorySearch.searchSKU("Name","0-0-1");
					browser.sleep(2000);
					inventorySearch.selectSKU();
					inventorySearch.addProduct();
					browser.sleep(2000);
					inventorySearch.searchInventory();
					browser.sleep(2000);                
					expect(inventorySearch.getAvailableQty()).toEqual(updatedAvlQty.toString());
                });
                
                
            });    
             
        });
        
})

